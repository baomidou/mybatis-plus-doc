---
title: é«˜åº¦ãªæ©Ÿèƒ½
sidebar:
  order: 19
---

import { LinkCard } from '@astrojs/starlight/components';

Mybatis-Mate ã¯ã€MyBatis-Plus å¯¾ã—ã¦æä¾›ã•ã‚Œã‚‹ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºå‘ã‘ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§ã‚ã‚Šã€ãƒ‡ãƒ¼ã‚¿ã‚’ã‚ˆã‚Šè¿…é€Ÿã‹ã¤å„ªé›…ã«å‡¦ç†ã™ã‚‹ã“ã¨ã‚’ç›®çš„ã¨ã—ã¦ã„ã¾ã™ã€‚

- ä½¿ç”¨ä¾‹ ï¼š[ãƒãƒ¼ã‚¿ãƒ«](https://gitee.com/baomidou/mybatis-mate-examples)
- ä½œè€…ã«é€£çµ¡ã—ã¦ç¢ºèªã‚’å–ã£ãŸã†ãˆã§ã€WeChatå…¬å¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ Mybatis-Mate ã‚’ç´¹ä»‹ã™ã‚‹è¨˜äº‹ã‚’æŠ•ç¨¿ã™ã‚Œã°ã€æ°¸ä¹…å€‹äººãƒ©ã‚¤ã‚»ãƒ³ã‚¹è¨¼æ˜æ›¸ã‚’ç„¡æ–™ã§å–å¾—ã§ãã¾ã™ã€‚
- ã“ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¯ MyBatis-Plus ã®æ‹¡å¼µãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«å±ã—ã¦ãŠã‚Šã€æœ‰æ–™ç‰ˆã® MyBatis-Plus ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ã™ã¹ã¦ã®å•é¡Œã¯ `é’è‹—` å€‹äººã®è²¬ä»»ã¨ãªã‚Šã¾ã™ã€‚

<LinkCard
  title="ç„¡æ–™å‹•ç”»ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«"
  description="é’è‹—ã«ã‚ˆã‚‹åˆ¶ä½œã€å“è³ªä¿è¨¼ä»˜ã"
  href="https://space.bilibili.com/212983666/channel/collectiondetail?sid=606288"
/>

## ãƒ‡ãƒ¼ã‚¿ç›£æŸ»ï¼ˆç…§åˆï¼‰

- ä½¿ç”¨ä¾‹ï¼šğŸ‘‰ [mybatis-mate-audit](https://gitee.com/baomidou/mybatis-mate-examples/tree/master/mybatis-mate-audit)
- 2ã¤ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®å·®ç•°ã‚’æ¯”è¼ƒã—ã¾ã™ã€‚ä¾‹ï¼šéŠ€è¡Œã®å–å¼•æ˜ç´°ã®ç…§åˆä½œæ¥­ã€‚
  ```java
  // 1ï¼Œå¼‚æ­¥å›è°ƒï¼Œæ³¨æ„ @EnableAsync å¼€å¯å¼‚æ­¥
  applicationEventPublisher.publishEvent(new DataAuditEvent((t) -> {
      List<Change> changes = t.apply(newVersion, oldVersion);
      for (Change valueChange : changes) {
          ValueChange change = (ValueChange) valueChange;
          System.err.println(String.format("%sä¸€è‡´ã—ã¾ã›ã‚“ã€‚æ­£ã—ã„å€¤ %s å®Ÿéš›ã®å€¤ %s", change.getPropertyName(), change.getLeft(), change.getRight()));
      }
  }));

  // 2ï¼Œæ‰‹åŠ¨è°ƒç”¨å¯¹æ¯”
  DataAuditor.compare(obj1, obj2);
  ```

## ãƒ‡ãƒ¼ã‚¿ã®ã‚»ãƒ³ã‚·ãƒ†ã‚£ãƒ–ãƒ¯ãƒ¼ãƒ‰ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°

- ä½¿ç”¨ä¾‹ğŸ‘‰ [mybatis-mate-sensitive-words](https://gitee.com/baomidou/mybatis-mate-examples/tree/master/mybatis-mate-sensitive-words)
- ãƒ‡ãƒ¼ã‚¿ã®ã‚»ãƒ³ã‚·ãƒ†ã‚£ãƒ–ãƒ¯ãƒ¼ãƒ‰ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ï¼ˆAC ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ï¼‰ï¼šãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã‚’è¨­å®šã™ã‚‹ã ã‘ã§ã€ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ãŒã™ã¹ã¦ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆå†…ã®æ–‡å­—åˆ—ã«å¯¾ã—ã¦è‡ªå‹•ã§ã‚»ãƒ³ã‚·ãƒ†ã‚£ãƒ–ãƒ¯ãƒ¼ãƒ‰ã®ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã‚’è¡Œã„ã¾ã™ã€‚ãƒã‚¹ãƒˆã•ã‚ŒãŸã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚‚ã‚µãƒãƒ¼ãƒˆã—ã€ã‚»ãƒ³ã‚·ãƒ†ã‚£ãƒ–ãƒ¯ãƒ¼ãƒ‰ã‚’å®Œå…¨ã«æ¤œå‡ºã—ã¾ã™ã€‚
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ã‚ˆã‚‹ã‚»ãƒ«ãƒ•ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹å‹ã‚»ãƒ³ã‚·ãƒ†ã‚£ãƒ–ãƒ¯ãƒ¼ãƒ‰è¾æ›¸ï¼ˆç„¡æ–™ãƒ»åˆ¶å¾¡å¯èƒ½ï¼‰ï¼šãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã•ã‚ŒãŸèªæ ¹ã‚’èª­ã¿è¾¼ã¿ã€æŒ‡å®šã—ãŸè¾æ›¸ã§ã®å†èª­ã¿è¾¼ã¿ã‚‚ã‚µãƒãƒ¼ãƒˆã—ã¾ã™ã€‚

## ãƒ‡ãƒ¼ã‚¿ç¯„å›²ï¼ˆãƒ‡ãƒ¼ã‚¿æ¨©é™ï¼‰

- ä½¿ç”¨ä¾‹ï¼š[mybatis-mate-datascope](https://gitee.com/baomidou/mybatis-mate-examples/tree/master/mybatis-mate-datascope)
- @DataScope ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³
  |  å±æ€§  |     å‹     | å¿…é ˆæŒ‡å®š | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ | èª¬æ˜                                   |
  | :----: | :----------: | :------: | :----: | -------------------------------------- |
  |  type  |    String    |    å¦    |   ""   | ç¯„å›²ã‚¿ã‚¤ãƒ—ã€‚ãƒ“ã‚¸ãƒã‚¹åˆ†é¡ã‚’åŒºåˆ¥ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã€‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ç©º |
  | value  | DataColumn[] |    å¦    |   {}   | ãƒ‡ãƒ¼ã‚¿æ¨©é™ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã€‚è¤‡æ•°ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®çµ„ã¿åˆã‚ã›ã‚’ã‚µãƒãƒ¼ãƒˆ |
  | ignore |   boolean    |    å¦    | false  | æ¨©é™å‡¦ç†ãƒ­ã‚¸ãƒƒã‚¯ã‚’ç„¡è¦–ã™ã‚‹ã‹ã©ã†ã‹ã€‚true ã¯ç„¡è¦– false ã¯ç„¡è¦–ã—ãªã„ |
- @DataColumn ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³
  |  å±æ€§  |     å‹     | å¿…é ˆæŒ‡å®š | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ | èª¬æ˜                                   |
  | :---: | :----: | :------: | :----: | ---------- |
  | alias | String |    å¦    |   ""   | é–¢é€£ãƒ†ãƒ¼ãƒ–ãƒ«ã‚¨ã‚¤ãƒªã‚¢ã‚¹ |
  | name  | String |    æ˜¯    |        | ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å     |
- è¡Œãƒ¬ãƒ™ãƒ«ã®ç²’åº¦ã®æ¨©é™åˆ¶å¾¡ã§ã™ã€‚ä¾‹ï¼šä¸Šä½éƒ¨é–€ã¯å­éƒ¨é–€ã®æƒ…å ±ã‚’ç¢ºèªã§ãã¾ã™ã€‚
  ```java
  // ãƒ†ã‚¹ãƒˆ test ã‚¿ã‚¤ãƒ—ã®ãƒ‡ãƒ¼ã‚¿æ¨©é™ç¯„å›²ã€æ··åˆãƒšãƒ¼ã‚¸ãƒ³ã‚°ãƒ¢ãƒ¼ãƒ‰
  @DataScope(type = "test", value = {
          // é–¢é€£ãƒ†ãƒ¼ãƒ–ãƒ« user ã«ã‚¨ã‚¤ãƒªã‚¢ã‚¹ u ã‚’ä»˜ã‘ã€éƒ¨é–€ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®æ¨©é™ã‚’æŒ‡å®šã—ã¾ã™ã€‚
          @DataColumn(alias = "u", name = "department_id"),
          // é–¢é€£ãƒ†ãƒ¼ãƒ–ãƒ« user ã«ã‚¨ã‚¤ãƒªã‚¢ã‚¹ u ã‚’ä»˜ã‘ã€æºå¸¯é›»è©±ç•ªå·ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’æŒ‡å®šã—ã¾ã™ï¼ˆè‡ªå‹•ã§åˆ¤æ–­ã—ã¦å‡¦ç†ï¼‰ã€‚
          @DataColumn(alias = "u", name = "mobile")
  })
  @Select("select u.* from user u")
  List<User> selectTestList(IPage<User> page, Long id, @Param("name") String username);

  // ãƒ‡ãƒ¼ã‚¿æ¨©é™ã‚’ãƒ†ã‚¹ãƒˆã—ã€æœ€çµ‚çš„ã«å®Ÿè¡Œã•ã‚Œã‚‹ SQL æ–‡ã‚’ç¢ºèªã—ã¾ã™ã€‚
  SELECT u.* FROM user u WHERE (u.department_id IN ('1', '2', '3', '5')) AND u.mobile LIKE '%1533%' LIMIT 1,10
  ```

:::note[`IDataScopeProvider` ã«ã¤ã„ã¦ã®èª¬æ˜]

ãƒ‡ãƒ¼ã‚¿æ¨©é™ã‚’å‡¦ç†ã™ã‚‹ã«ã¯ã€å¿…ãš IDataScopeProvider ã®å®Ÿè£…ã‚¯ãƒ©ã‚¹ã‚’æ³¨å…¥ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ãƒ‡ãƒ¼ã‚¿ã®å¼•æ•°æ¸¡ã—ã«ã¤ã„ã¦ã¯ã€æ¬¡ã®2ã¤ã®æ–¹æ³•ãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã™ã€‚
1ï¼ã‚«ã‚¹ã‚¿ãƒ ã® mapper ãƒ¡ã‚½ãƒƒãƒ‰ã§ãƒ¡ã‚½ãƒƒãƒ‰å¼•æ•°ã¨ã—ã¦æ¸¡ã—ã€setWhere ãƒ¡ã‚½ãƒƒãƒ‰å†…ã® `Object[] args` ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã‹ã‚‰å–å¾—ã™ã‚‹ã€‚
2ï¼ThreadLocal ã‚’åˆ©ç”¨ã—ã¦ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã‚’æ¸¡ã™ã€‚Controller å±¤ã‚„ Service å±¤ã‚’ã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ãƒˆã—ã¦ãƒ‡ãƒ¼ã‚¿æ¨©é™å‡¦ç†ç”¨ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã‚’è¨­å®šã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã•ã‚‰ã«è©³ã—ãã¯â€¦ ğŸ‘‰[å‚è€ƒ](https://gitee.com/baomidou/mybatis-plus-samples/tree/master/mybatis-plus-sample-dynamic-tablename)

:::

## ãƒ†ãƒ¼ãƒ–ãƒ«æ§‹é€ ã®è‡ªå‹•ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹

- ä½¿ç”¨ä¾‹ï¼š
  - ğŸ‘‰ [mybatis-mate-ddl-mysql](https://gitee.com/baomidou/mybatis-mate-examples/tree/master/mybatis-mate-ddl-mysql)
  - ğŸ‘‰ [mybatis-mate-ddl-postgres](https://gitee.com/baomidou/mybatis-mate-examples/tree/master/mybatis-mate-ddl-postgres)
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã® `Schema` åˆæœŸåŒ–ãŠã‚ˆã³ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ç”¨ã® SQL ã‚’è‡ªå‹•ã§ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã—ã¾ã™ã€‚`flyway` ã¨ã¯ç•°ãªã‚Šã€åˆ†å‰²ãƒ†ãƒ¼ãƒ–ãƒ«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ã‚µãƒãƒ¼ãƒˆã—ã€ã‚³ãƒ¼ãƒ‰ã«ã‚ˆã‚‹ SQL ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å®Ÿè¡Œã‚’åˆ¶å¾¡ã§ãã¾ã™ã€‚
- åˆå›å®Ÿè¡Œæ™‚ã«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å†…ã« `ddl_history` ãƒ†ãƒ¼ãƒ–ãƒ«ãŒç”Ÿæˆã•ã‚Œã€ä»¥é™ SQL ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œã™ã‚‹ãŸã³ã«ãƒãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ±ãŒè‡ªå‹•çš„ã«ç®¡ç†ã•ã‚Œã¾ã™ã€‚
  ```java
  @Component
  public class MysqlDdl implements IDdl {

      /**
       * SQL ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å®Ÿè¡Œæ–¹æ³•
       */
      @Override
      public List<String> getSqlFiles() {
          return Arrays.asList(
                  "db/tag-schema.sql",
                  "D:\\db\\tag-data.sql"
          );
      }
  }

  // MySQL ã®ã‚¹ãƒ¬ãƒ¼ãƒ–ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«åˆ‡ã‚Šæ›¿ãˆã¦ã€SQL ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œã—ã¾ã™
  ShardingKey.change("mysqlt2");
  ddlScript.run(new StringReader("DELETE FROM user;\n" +
          "INSERT INTO user (id, username, password, sex, email) VALUES\n" +
          "(20, 'Duo', '123456', 0, 'Duo@baomidou.com');"));
  ```

## ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãƒ‡ãƒ¼ã‚¿ã®ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ï¼ˆè¾æ›¸ã«ã‚ˆã‚‹å€¤ã®æ›¸ãæˆ»ã—ï¼‰

- ä½¿ç”¨ä¾‹ï¼šğŸ‘‰ [mybatis-mate-dict](https://gitee.com/baomidou/mybatis-mate-examples/tree/master/mybatis-mate-dict)
- æ³¨è§£ @FieldBind
  |   å±æ€§   |  å‹  | å¿…é ˆæŒ‡å®š | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ | èª¬æ˜                                               |
  | :------: | :----: | :------: | :----: | -------------------------------------------------- |
  | sharding | String |    å¦    |   ""   | åˆ†å‰²ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ»åˆ†å‰²ãƒ†ãƒ¼ãƒ–ãƒ«ã®ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹æŒ‡å®š                                 |
  |   type   | String |    æ˜¯    |        | ã‚¿ã‚¤ãƒ—ï¼ˆç•°ãªã‚‹ãƒ“ã‚¸ãƒã‚¹ã‚’åŒºåˆ¥ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ï¼‰                           |
  |  target  | String |    æ˜¯    |        | ã‚¿ãƒ¼ã‚²ãƒƒãƒˆè¡¨ç¤ºå±æ€§ï¼ˆãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ã™ã‚‹å±æ€§ã€‚ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ä»¥å¤–ã¯é™¤å¤–ã—ã¦ãã ã•ã„ï¼‰ |
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã® `sex` å€¤ãŒ `0`ã€`1` ã®å ´åˆã€è‡ªå‹•çš„ã« `ç”·`ã€`å¥³` ã«ãƒãƒƒãƒ”ãƒ³ã‚°ã•ã‚Œã¾ã™ã€‚
- ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¸ã®ãƒãƒƒãƒ”ãƒ³ã‚°ã‚‚å¯èƒ½ã§ã™ã€‚ä¾‹ï¼šæ³¨æ–‡ ID ã«åŸºã¥ã„ã¦æ³¨æ–‡ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¾ãŸã¯æ³¨æ–‡ç•ªå·ã‚’ãƒãƒƒãƒ”ãƒ³ã‚°ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
  ```java
  @FieldBind(type = "user_sex", target = "sexText")
  private Integer sex;
  // è¡¨ç¤ºç”¨ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ã—ã€ãƒ†ãƒ¼ãƒ–ãƒ«ã«å­˜åœ¨ã—ãªã„è¾æ›¸é …ç›®ã‚’é™¤å¤–ã—ã¾ã™ã€‚
  @TableField(exist = false)
  private String sexText;
  ```
- æ¥­å‹™å‡¦ç†ã‚¯ãƒ©ã‚¹ã‚’ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ã™ã‚‹ã«ã¯ã€IDataBind ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’å®Ÿè£…ã—ã€Spring ã‚³ãƒ³ãƒ†ãƒŠã«æ³¨å…¥ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
  ```java
  @Component
  public class DataBind implements IDataBind {
    ...
  }
  ```

## ä»®æƒ³ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°

- ä½¿ç”¨ä¾‹ï¼šğŸ‘‰ [mybatis-mate-jsonbind](https://gitee.com/baomidou/mybatis-mate-examples/tree/master/mybatis-mate-jsonbind)
- @JsonBind ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³
  ```java
  @JsonBind("ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ã‚¿ã‚¤ãƒ—")
  public class User {
      ...
  }
  ```
- è¿”å´ã•ã‚Œã‚‹ Json ã«å¯¾ã™ã‚‹ä»®æƒ³ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°æˆ¦ç•¥
  ```java
  @Component
  public class JsonBindStrategy implements IJsonBindStrategy {

      @Override
      public Map<String, Function<Object, Map<String, Object>>> getStrategyFunctionMap() {
          return new HashMap<String, Function<Object, Map<String, Object>>>(16) {
              {
                  // ä»®æƒ³ãƒãƒ¼ãƒ‰ã‚’æ³¨å…¥ã™ã‚‹
                  put(Type.departmentRole, (obj) -> new HashMap(2) {{
                      User user = (User) obj;
                      // åˆ—æŒ™å‹ã®å¤‰æ›
                      put("statusText", StatusEnum.get(user.getStatus()).getDesc());
                      // ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’å‘¼ã³å‡ºã—ã¦ãƒ­ãƒ¼ãƒ«æƒ…å ±ã‚’å–å¾—å¯èƒ½
                      put("roleName", "ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼");
                  }});
              }
          };
      }
  }
  ```

## ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®æš—å·åŒ–ã¨å¾©å·åŒ–

- ä½¿ç”¨ä¾‹ï¼šğŸ‘‰ [mybatis-mate-encrypt](https://gitee.com/baomidou/mybatis-mate-examples/tree/master/mybatis-mate-encrypt)
- @FieldEncrypt ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³
  |   å±æ€§    |    å‹    | å¿…é ˆæŒ‡å®š |      ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤      | èª¬æ˜                 |
  | :-------: | :-------: | :------: | :--------------: | -------------------- |
  | password  |  String   |    å¦    |        ""        | æš—å·åŒ–ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰             |
  | algorithm | Algorithm |    å¦    | PBEWithMD5AndDES | PBE MD5 DES æ··åˆã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ  |
  | encryptor |   Class   |    å¦    |    IEncryptor    | æš—å·åŒ–ãƒ—ãƒ­ã‚»ãƒƒã‚µ           |
- ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 
  |            ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ              |              èª¬æ˜              |
  | :-------------------------: |:----------------------------:|
  |           MD5_32            |     32ãƒ“ãƒƒãƒˆ MD5 ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ               |
  |           MD5_16            |         16ãƒ“ãƒƒãƒˆ MD5 ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ           |
  |           BASE64            |      64æ–‡å­—ã§ä»»æ„ã®ãƒã‚¤ãƒŠãƒªãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¾ã™ã‚‹ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ       |
  |             AES             |  AES å¯¾ç§°ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ  ã€ã‚ã„ã¾ã„æ¤œç´¢ãŒå¿…è¦ãªå ´åˆã¯å¿…ãšã“ã®ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‘  |
  |             RSA             |           éå¯¾ç§°æš—å·åŒ–ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ             |
  |             SM2             |    å›½å¯† SM2 éå¯¾ç§°æš—å·åŒ–ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã€ECC ãƒ™ãƒ¼ã‚¹     |
  |             SM3             | å›½å¯† SM3 ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ€ã‚¤ã‚¸ã‚§ã‚¹ãƒˆã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã€MD5 ã¨æ¯”è¼ƒã—ã¦ç†è§£ã§ãã¾ã™ | 
  |             SM4             | å›½å¯† SM4 å¯¾ç§°æš—å·åŒ–ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã€ç„¡ç·šLANæ¨™æº–ã®ãƒ‘ã‚±ãƒƒãƒˆãƒ‡ãƒ¼ã‚¿ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ  |
  |      PBEWithMD5AndDES       |             æ··åˆã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ              |
  |   PBEWithMD5AndTripleDES    |             æ··åˆã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ              |
  | PBEWithHMACSHA512AndAES_256 |             æ··åˆã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ              |
  |    PBEWithSHA1AndDESede     |             æ··åˆã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ              |
  |    PBEWithSHA1AndRC2_40     |             æ··åˆã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ              |
- ğŸ‘‰ [å›½å¯† SM2.3.4 ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ä½¿ç”¨è¦ç´„](https://gitee.com/baomidou/mybatis-mate-examples/tree/master/%E5%9B%BD%E5%AF%86SM2.3.4%E7%AE%97%E6%B3%95%E4%BD%BF%E7%94%A8%E8%A7%84%E8%8C%83)
  :::note

  - MD5 ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã¯ä¸å¯é€†ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã§ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ä¿å­˜ã•ã‚Œã‚‹å€¤ã¨ã‚¯ã‚¨ãƒªçµæœã¯ã™ã¹ã¦æš—å·æ–‡ã§ã™ã€‚
  - SM4 ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã¯ bouncycastle æš—å·åŒ–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«ä¾å­˜ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
  - æ··åˆã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã¯ jasypt æš—å·åŒ–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«ä¾å­˜ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
  - ã€æ³¨æ„ã€‘æš—å·åŒ–ã•ã‚ŒãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ã‚¯ã‚¨ãƒªã§è¿”ã™å ´åˆã¯ã€å¿…ãš`æš—å·åŒ–ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³`æƒ…å ±ã‚’å«ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚å˜ç´”ã« String ã‚„ List ãªã©ã®é›†åˆã‚’è¿”ã™ã ã‘ã§ã¯å¾©å·åŒ–ã§ãã¾ã›ã‚“ã€‚

  :::
- ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ `FieldEncrypt` ã§ãƒ‡ãƒ¼ã‚¿ã®æš—å·åŒ–ã¨å¾©å·åŒ–ã‚’å®Ÿè£…ã—ã€è¤‡æ•°ã®æš—å·åŒ–ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¾ã™
  ```java
  @FieldEncrypt
  private String email;
  ```

## ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ãƒã‚¹ã‚­ãƒ³ã‚°

- ä½¿ç”¨ä¾‹ï¼šğŸ‘‰ [mybatis-mate-sensitive-jackson](https://gitee.com/baomidou/mybatis-mate-examples/tree/master/mybatis-mate-sensitive-jackson)
- ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ @FieldSensitive
- ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ `FieldSensitive` ã§ãƒ‡ãƒ¼ã‚¿ã®ãƒã‚¹ã‚­ãƒ³ã‚°ã‚’å®Ÿè£…ã—ã€`æºå¸¯é›»è©±ç•ªå·`ã€`ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹`ã€`éŠ€è¡Œå£åº§ç•ªå·` ãªã©9ç¨®é¡ã®ä¸€èˆ¬çš„ãªãƒã‚¹ã‚­ãƒ³ã‚°ãƒ«ãƒ¼ãƒ«ãŒçµ„ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã™
  ```java
  @FieldSensitive("testStrategy")
  private String username;

  @Configuration
  public class SensitiveStrategyConfig {

      /**
       * ãƒã‚¹ã‚­ãƒ³ã‚°æˆ¦ç•¥ã‚’æ³¨å…¥
       */
      @Bean
      public ISensitiveStrategy sensitiveStrategy() {
          // ã‚«ã‚¹ã‚¿ãƒ  testStrategy ã‚¿ã‚¤ãƒ—ã®ãƒã‚¹ã‚­ãƒ³ã‚°å‡¦ç†
          return new SensitiveStrategy().addStrategy("testStrategy", t -> t + "***test***");
      }
  }

  // ãƒã‚¹ã‚­ãƒ³ã‚°å‡¦ç†ã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã€ç·¨é›†ã‚·ãƒŠãƒªã‚ªã§ä½¿ç”¨
  RequestDataTransfer.skipSensitive();
  ```

## è¤‡æ•°ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ã®åˆ†å‰²ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ»åˆ†å‰²ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆèª­ã¿æ›¸ãåˆ†é›¢ï¼‰

- ä½¿ç”¨ä¾‹ï¼šğŸ‘‰ [mybatis-mate-sharding](https://gitee.com/baomidou/mybatis-mate-examples/tree/master/mybatis-mate-sharding)
- ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ @Sharding
  |   å±æ€§   |  å‹  | å¿…é ˆæŒ‡å®š |         ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤         | èª¬æ˜                         |
  | :------: | :----: | :------: | :--------------------: | ---------------------------- |
  |  value   | String |    æ˜¯    |           ""           | åˆ†å‰²ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—åã€ç©ºã®å ´åˆã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ãƒ—ãƒ©ã‚¤ãƒãƒªãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ã‚’ä½¿ç”¨ |
  | strategy | Class  |    å¦    | RandomShardingStrategy | åˆ†å‰²ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼†åˆ†å‰²ãƒ†ãƒ¼ãƒ–ãƒ«æˆ¦ç•¥                |
- è¨­å®š
  ```xml
  mybatis-mate:
    sharding:
      health: true # ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
      primary: mysql # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹é¸æŠ
      datasource:
        mysql: # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—
          - key: node1
            ...
          - key: node2
            cluster: slave # èª­ã¿æ›¸ãåˆ†é›¢æ™‚ã«ã‚¹ãƒ¬ãƒ¼ãƒ–ãŒ SQL ã®ã‚¯ã‚¨ãƒªæ“ä½œã‚’æ‹…å½“ã€‚ãƒ—ãƒ©ã‚¤ãƒãƒªã®masterã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§è¨˜è¿°ä¸è¦
            ...
        postgres:
          - key: node1 # ãƒ‡ãƒ¼ã‚¿ãƒãƒ¼ãƒ‰
            ...
  ```
- ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ `Sharding` ã§ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ã‚’åˆ‡ã‚Šæ›¿ãˆã€ã‚°ãƒ«ãƒ¼ãƒ—å†…ã®ãƒãƒ¼ãƒ‰ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ãƒ©ãƒ³ãƒ€ãƒ ã«é¸æŠã•ã‚Œã¾ã™ï¼ˆèª­ã¿å–ã‚Šã¯ã‚¹ãƒ¬ãƒ¼ãƒ–ã€æ›¸ãè¾¼ã¿ã¯ãƒ—ãƒ©ã‚¤ãƒãƒªï¼‰
  ```java
  @Mapper
  @Sharding("mysql")
  public interface UserMapper extends BaseMapper<User> {

      @Sharding("postgres")
      Long selectByUsername(String username);

  }
  ```
- æŒ‡å®šã—ãŸãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒãƒ¼ãƒ‰ã«åˆ‡ã‚Šæ›¿ãˆã‚‹
  ```java
  // MySQL ã®ã‚¹ãƒ¬ãƒ¼ãƒ– node2 ãƒãƒ¼ãƒ‰ã«åˆ‡ã‚Šæ›¿ãˆã¾ã™
  ShardingKey.change("mysqlnode2");
  ```

## è¤‡æ•°ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ã®å‹•çš„ãªãƒ­ãƒ¼ãƒ‰ãŠã‚ˆã³ã‚¢ãƒ³ãƒ­ãƒ¼ãƒ‰

- ä½¿ç”¨ä¾‹ï¼šğŸ‘‰ [mybatis-mate-sharding-dynamic](https://gitee.com/baomidou/mybatis-mate-examples/tree/master/mybatis-mate-sharding-dynamic)

## è¤‡æ•°ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ã®ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆJTA Atomikosï¼‰

- ä½¿ç”¨ä¾‹ï¼šğŸ‘‰ [mybatis-mate-sharding-jta-atomikos](https://gitee.com/baomidou/mybatis-mate-examples/tree/master/mybatis-mate-sharding-jta-atomikos)
