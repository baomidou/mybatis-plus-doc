---
title: è‡ªåŠ¨å¡«å……åŠŸèƒ½
date: 2021-12-14 19:06:36
permalink: /pages/4c6bcf/
article: false

---

ç¤ºä¾‹å·¥ç¨‹ï¼š

ğŸ‘‰ [mybatis-plus-sample-auto-fill-metainfo](https://gitee.com/baomidou/mybatis-plus-samples/tree/master/mybatis-plus-sample-auto-fill-metainfo)

åŸç†:

- å®ç°å…ƒå¯¹è±¡å¤„ç†å™¨æ¥å£ï¼šcom.baomidou.mybatisplus.core.handlers.MetaObjectHandler

- æ³¨è§£å¡«å……å­—æ®µ `@TableField(.. fill = FieldFill.INSERT)` ç”Ÿæˆå™¨ç­–ç•¥éƒ¨åˆ†ä¹Ÿå¯ä»¥é…ç½®ï¼

```java
public class User {

    // æ³¨æ„ï¼è¿™é‡Œéœ€è¦æ ‡è®°ä¸ºå¡«å……å­—æ®µ
    @TableField(.. fill = FieldFill.INSERT)
    private String fillField;

    ....
}
```

- è‡ªå®šä¹‰å®ç°ç±» MyMetaObjectHandler

```java
@Slf4j
@Component
public class MyMetaObjectHandler implements MetaObjectHandler {

    @Override
    public void insertFill(MetaObject metaObject) {
        log.info("start insert fill ....");
        this.strictInsertFill(metaObject, "createTime", LocalDateTime.class, LocalDateTime.now()); // èµ·å§‹ç‰ˆæœ¬ 3.3.0(æ¨èä½¿ç”¨)
        // æˆ–è€…
        this.strictInsertFill(metaObject, "createTime", () -> LocalDateTime.now(), LocalDateTime.class); // èµ·å§‹ç‰ˆæœ¬ 3.3.3(æ¨è)
        // æˆ–è€…
        this.fillStrategy(metaObject, "createTime", LocalDateTime.now()); // ä¹Ÿå¯ä»¥ä½¿ç”¨(3.3.0 è¯¥æ–¹æ³•æœ‰bug)
    }

    @Override
    public void updateFill(MetaObject metaObject) {
        log.info("start update fill ....");
        this.strictUpdateFill(metaObject, "updateTime", LocalDateTime.class, LocalDateTime.now()); // èµ·å§‹ç‰ˆæœ¬ 3.3.0(æ¨è)
        // æˆ–è€…
        this.strictUpdateFill(metaObject, "updateTime", () -> LocalDateTime.now(), LocalDateTime.class); // èµ·å§‹ç‰ˆæœ¬ 3.3.3(æ¨è)
        // æˆ–è€…
        this.fillStrategy(metaObject, "updateTime", LocalDateTime.now()); // ä¹Ÿå¯ä»¥ä½¿ç”¨(3.3.0 è¯¥æ–¹æ³•æœ‰bug)
    }
}
```

::: warning æ³¨æ„äº‹é¡¹ï¼š

- å¡«å……åŸç†æ˜¯ç›´æ¥ç»™`entity`çš„å±æ€§è®¾ç½®å€¼!!!

- æ³¨è§£åˆ™æ˜¯æŒ‡å®šè¯¥å±æ€§åœ¨å¯¹åº”æƒ…å†µä¸‹å¿…æœ‰å€¼,å¦‚æœæ— å€¼åˆ™å…¥åº“ä¼šæ˜¯`null`

- `MetaObjectHandler`æä¾›çš„é»˜è®¤æ–¹æ³•çš„ç­–ç•¥å‡ä¸º:å¦‚æœå±æ€§æœ‰å€¼åˆ™ä¸è¦†ç›–,å¦‚æœå¡«å……å€¼ä¸º`null`åˆ™ä¸å¡«å……

- å­—æ®µå¿…é¡»å£°æ˜`TableField`æ³¨è§£,å±æ€§`fill`é€‰æ‹©å¯¹åº”ç­–ç•¥,è¯¥å£°æ˜å‘ŠçŸ¥`Mybatis-Plus`éœ€è¦é¢„ç•™æ³¨å…¥`SQL`å­—æ®µ

- å¡«å……å¤„ç†å™¨`MyMetaObjectHandler`åœ¨ Spring Boot ä¸­éœ€è¦å£°æ˜`@Component`æˆ–`@Bean`æ³¨å…¥

- è¦æƒ³æ ¹æ®æ³¨è§£`FieldFill.xxx`å’Œ`å­—æ®µå`ä»¥åŠ`å­—æ®µç±»å‹`æ¥åŒºåˆ†å¿…é¡»ä½¿ç”¨çˆ¶ç±»çš„`strictInsertFill`æˆ–è€…`strictUpdateFill`æ–¹æ³•

- ä¸éœ€è¦æ ¹æ®ä»»ä½•æ¥åŒºåˆ†å¯ä»¥ä½¿ç”¨çˆ¶ç±»çš„`fillStrategy`æ–¹æ³•

- update(T t,Wrapper<T> updateWrapper)æ—¶tä¸èƒ½ä¸ºç©º,å¦åˆ™è‡ªåŠ¨å¡«å……å¤±æ•ˆ

- å½“è‡ªå®šä¹‰mapperæ–¹æ³•éœ€è¦èµ°å¡«å……æ—¶,å»ºè®®æŒ‰ä¸‹åˆ—æ³¨è§£æ–¹å¼æ·»åŠ å‚æ•°æ³¨è§£(å¦‚æœä½¿ç”¨ç¼–è¯‘å‚æ•°ä¿ç•™çš„æƒ…å†µä¸‹,å˜é‡åå­—ä¸æ³¨è§£åå­—ä¿æŒä¸€è‡´ä¹Ÿè¡Œ)

  | æ•°æ®ç±»å‹   | æ³¨è§£                                        | ç¤ºä¾‹                                                     |
  | ---------- | ------------------------------------------- | -------------------------------------------------------- |
  | Collection | @Param("collection") æˆ–  ~~@Param("coll")~~ | saveXxx(@Param("collection") Collection<H2User> h2Users) |
  | List       | @Param("list")                              | saveXxx(@Param("list") List<H2User> h2Users)             |
  | Array      | @Param("array")                             | saveXxx(@Param("array") H2User[] h2Users)                |
  | å®ä½“       | @Param("et")                                | saveXxx(@Param("et") H2User h2Users)                     |

  å¤šå‚æ•°å¡«å……ç¤ºä¾‹: 

  ```java
   insertFillByCustomMethod1(H2User h2User);
   insertFillByCustomMethod8(H2User[] h2Users);
   insertFillByCustomMethod6(@Param("coll") Collection<H2User> h2User);
   insertFillByCustomMethod5(@Param("collection") Collection<H2User> h2User);
   insertFillByCustomMethod7(@Param("list") List<H2User> h2User);
   insertFillByCustomMethod9(@Param("array") H2User[] h2Users);
   //etæ ‡è®°çš„ä¼šå¡«å……,collè™½ç„¶æ˜¯ç‰¹æ®Šçš„keyå€¼,ä½†ä¸å±äºå®ä½“,æ‰€ä»¥ä¸ä¼šå¤„ç†
   updateFillByCustomMethod2(@Param("coll") Collection<Long> ids, @Param("et") H2User h2User);  
   updateFillByCustomMethod4(@Param("colls") Collection<Long> ids, @Param("et") H2User h2User);
  
  ```

  æ— æ³•å¡«å……ç¤ºä¾‹: 

  ```java
  //æ–¹æ³•è™½ç„¶ä¸ä¸Šé¢æ–¹æ³•ä¸€è‡´,ä½†keyå€¼ä¸æ»¡è¶³å¡«å……æ¡ä»¶,éœ€è¦å°†useræ¢æˆetæ‰èƒ½æ­£ç¡®å¡«å…… 
  updateFillByCustomMethod3(@Param("coll") Collection<Long> ids, @Param("user") H2User h2User); 
  ```

  


â€‹    æ³¨æ„: 3.5.3.3-SNAPSHOTç‰ˆæœ¬ä¹‹å‰æœ‰æœªå¤„ç†ç±»å‹ä¸åŒ¹é…æƒ…å†µ,å½“å‚æ•°åç§°ä¸ä¸Šè¡¨ä¸€è‡´ä½†ç±»å‹ä¸ä¸€è‡´çš„è¯ä¼šå¯¼è‡´å¼ºè½¬é”™è¯¯. [ä¼ é€é—¨](https://github.com/baomidou/mybatis-plus/pull/5375)

:::

```java
public enum FieldFill {
    /**
     * é»˜è®¤ä¸å¤„ç†
     */
    DEFAULT,
    /**
     * æ’å…¥å¡«å……å­—æ®µ
     */
    INSERT,
    /**
     * æ›´æ–°å¡«å……å­—æ®µ
     */
    UPDATE,
    /**
     * æ’å…¥å’Œæ›´æ–°å¡«å……å­—æ®µ
     */
    INSERT_UPDATE
}
```xxxxxxxxxxÂ public enum FieldFill { Â  Â /** Â  Â  * é»˜è®¤ä¸å¤„ç† Â  Â  */ Â  Â DEFAULT, Â  Â /** Â  Â  * æ’å…¥å¡«å……å­—æ®µ Â  Â  */ Â  Â INSERT, Â  Â /** Â  Â  * æ›´æ–°å¡«å……å­—æ®µ Â  Â  */ Â  Â UPDATE, Â  Â /** Â  Â  * æ’å…¥å’Œæ›´æ–°å¡«å……å­—æ®µ Â  Â  */ Â  Â INSERT_UPDATE}java

```
